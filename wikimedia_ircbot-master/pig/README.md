# Batch Processing with Apache Pig

Example scripts for bulk batch processing of accumulated ircBot logs.

***

## "Pig eats everything."

Apache Pig is a great tool for batch processing and transformation of data.

Pig's `DISTINCT` function is a handy tool for addressing potential duplicate entries in log data; this scenario could occur if logs were sourced from multiple sensors (i.e. sensor diversity) with the same target.

While `Pig` programs often have a runtime of approximately 1.15x the equivalent of an optimally-written, native Java `MapReduce` program, `Pig` allows for code simplicity and ease of access to perform powerful batch processing.

***
## MapReduce vs Tez

Traditionally, `Pig` is run as a Hadoop application that uses the `MapReduce` execution engine.

With Apache Hadoop 2.0, and `YARN`, other execution engines can be used on a Hadoop cluster simultaneously. Under `YARN`, traditional `MapReduce` programs are run using `MapReduce2 (MR2)`.

`MapReduce` has been an excellent solution for batch processing, but has room for improvements, motivating the creation of new execution engines such as `Tez`. For example, many batch processes of data pipelines decompose into a series of directed, acyclic graphs (DAGs). `Pig` processing workflows are a good example, as many sets of cascading MapReduce jobs can be generated by a `Pig` process.

When using `MapReduce` as an execution engine with `Pig` (or `Hive`), execution engine overhead can be significant. For example, with `MapReduce`, the `Shuffle` phase entails writing of intermediate output ofthe `Map` phase to `HDFS` prior to the `Reduce` phase; iterative processes on a dataset can experience a significant runtime penalty. Similarly with DAG workflows, `YARN` resource containers need to be allocated and released for each `Map` and `Reduce` processing step, which can be very inefficient.

`Tez` provides an alternative execution engine to `MR2` that avoids such penalties through optimizations such as `YARN` container re-use. Rather than releasing and requesting additional containers, `Tez` driven programs allow multiple processing tasks to be executed by a container, reducing overhead.

### "Tez makes Pig fly"
With these example batch processes, we found `Tez` to reduce runtime by approximately 40-50%, a speedup of nearly 2.1x!

Read more about Tez here: http://hortonworks.com/hadoop/tez/

***

TODO:
- Implement Python-based UDF for parsing raw IRC log messages. (Eliminates need for pre-parsing)
-- http://pig.apache.org/docs/r0.9.1/udf.html#python-udfs
- Explore use of Pig on `Tez`
- Implement Python-based UDF for truncating ISO8601 timestamps into parameterized time-interval bins to simplify `Pig` scripts:
-- e.g. monthly/weekly/daily/hourly/minutes/seconds
