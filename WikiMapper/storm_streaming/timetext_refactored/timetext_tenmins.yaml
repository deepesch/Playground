# NOTE: THIS MUST BE UNIQUE
name: timetext-refactored-tenmins

topology:

    - spout:
        name: kafka-en-wikipedia
        type: kafka
        options:
            # The Kafka topic to stream from.
            # Required.
            topic: en.wikipedia

            # ZooKeeper connection string. Comma-separated list of ZooKeeper
            # servers.
            # Required.
            zk_hosts: 172.31.6.79:2181,172.31.5.24:2181,172.31.5.25:2181

            # Root path in ZooKeeper to store consumer offsets.
            # Defaults to: /pyleus-kafka-offsets/<topology name>
            zk_root: /pyleus-kafka-offsets/en-wikipedia-streaming/text.tenmins

            # Kafka consumer ID.
            # Defaults to: pyleus-<topology name>

            # IMPORTANT - ALWAYS CONFIRM KAFKA CONSUMER GROUP/ID
            #
            consumer_id: pyleus-timetext-tenmins

            # Whether the initial offset should be that specified by
            # start_offset_time (true) or the head of the stream (false).
            # Defaults to false.
            from_start: false

            # The offset time to start with if from_start is true.
            # Defaults to the earliest offset time in the stream.

            # We need to set a very large start_offset_time, which will be unused due to this issue:
            # See: https://github.com/Yelp/pyleus/issues/93
            start_offset_time: 2147483648
            # start_offset_time: 1398971060 


    # the initial processing step from the Kafka spout
    - bolt:
        name: parse-event
        module: en-wikipedia-streaming.parse_event
        parallelism_hint: 3
        groupings:
            - shuffle_grouping: kafka-en-wikipedia

    # an interval accumulation counter for receiving parsed tuples
    - bolt:
        name: count-events
        module: en-wikipedia-streaming.count_events

        tick_freq_secs: 600    # 3600 seconds per hour 
        parallelism_hint: 1
        options:

    # YES THAT IS A CLEARTEXT PASSWORD BELOW - HAVE FUN REACHING THIS HOST

            db_host: "172.31.12.55"
            db_user: "wiki_devel"
            db_pass: "2015insightde2015"
            db_name: "wikipedia"
            db_table: "en_wikipedia_tenmins"
            db_table_1: "meta_test_tenmins"
            db_table_2: ""
            
        groupings:
            - shuffle_grouping: parse-event
